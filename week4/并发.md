**题目 01- 请你说一说什么是线程和进程？**

- 区别

1：进程是资源分配的最小单位，开启一个项目、一个服务即为一个进程。

2：线程是在进程下运行的，一个进程可以有多个线程。

3：进程挂掉，线程也会全部挂掉。



- 关系

进程包含了线程。



- 线程的上下文切换是什么？

由于CPU为可压榨资源，所以现代操作系统下的CPU是利用了时间片轮转的方式轮番穿插地运行进程，只不过时间片切换的时间非常短，用户是感知不到的。



- 线程的并发与并行有啥区别？

有个煮咖啡的例子：

![coffee](.\picture\coffee.jpg)

并发是两个队列**交替**使用一台咖啡机，并行是两个队列**同时**使用两台咖啡机，如果串行，一个队列使用一台咖啡机，这效率无疑是最低的。



**题目 02- 使用了多线程会带来什么问题呢？**

- 能不能详细说说线程安全问题？

多个线程同时操作同一个共享资源的时候会出现业务安全问题。

例：假如有一个银行账户有1000元钱，A在线下取款机准备全部取出，同时又在手机上转账，同时操作（抛开操作时间不一致的情况），那么此时如果线程是不安全的，会导致A既线下取得了钱，又转账给其它人了钱，多出了1000，所以是有问题的。



- 原子性、有序性和可见性能不能深入的谈一下。

可见性一个线程修改共享变量后，其他线程可以立刻看到。

原子性一个或多个操作在CPU执行的过程中不可分割、不能被中断。

有序性程序按照代码先后顺序执行，不会因为指令重排而改变。



**题目 03- 什么是死锁？如何排查死锁?**

死锁是由于两个或以上的线程互相持有对方需要的资源,导致这些线程处于等待状态,无法执行。

死锁的条件：

1、互斥，共享资源 X 和 Y 只能被一个线程占用；

2、占有且等待，线程 T1 已经取得共享资源 X，在等待共享资源 Y 的时候，不释放共享资源 X；

3、不可抢占，其他线程不能强行抢占线程 T1 占有的资源；

4、循环等待，线程 T1 等待线程 T2 占有的资源，线程 T2 等待线程 T1 占有的资源，就是循环等待。

**选自《Java 并发编程实战》**



排查死锁：

可以使用jstack，当出现死锁的时候会发现 `Found one Java-level deadlock` 后面包含更多详细的信息。或者使用jconsole工具。



避免死锁：

1、破坏占用且等待条件：可增加一个中间管理员进行锁的管理和分配。

2、破坏不可抢占条件：核心是要能够主动释放它占有的资源。

3、破坏循环等待条件： 例：A->B->C->...->N->A形成环状。需要对资源进行排序，然后按序申请资源。